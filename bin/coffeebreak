#!/usr/bin/env node
'use strict';

var program = require('commander'),
	log = require('xqnode-logger');

var	pkg = require('../package.json'),
	coffeeBreak = require('../coffeebreak');


program
	.version(pkg.version)
	.usage('[command] [options]')
	.option('-d, --dev', 'Run in debug mode')
	.option('-p, --port <port>', 'Set server port', '3005')
	.option('-c, --coverage', 'Enable code coverage')
	.option('-r , --project <project>', 'Run only <project>')
	.option('-i , --diff <match>', 'Test title must match <match>');

program
	.command('server')
	.description('Start the server without running tests');

program
	.command('ci')
	.description('Continious integration mode. Start server, run all tests and shut the server down');

program.on('--help', function() {
	coffeeBreak('status');
});

program.parse(process.argv);

//Set debug mode
if (program.dev) {
	log.setLevel('debug');
}
else {
	log.setLevel('sys');
}

var command = program.args[0];

var options = {
	coverage: program.coverage,
	debug: program.debug,
	port: program.port,
	project: program.project
};

if (command === 'server') {
	coffeeBreak.start('server', options);
}
else if (command === 'ci') {
	coffeeBreak.start('ci', options);
}
else {
	coffeeBreak.start('default', options);
}
